<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>INTEC IA</title>
    <link
      href="{{ url_for('static', filename='css/intec_ia.css') }}"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav>
      <h2>INTEC IA</h2>
      <a href="/dashboard">‚Üê Portal do Aluno</a>
    </nav>

    <div class="main-container">
      <!-- Sidebar -->
      <div class="sidebar">
        <button onclick="clearChat()">üßπ Chat em branco</button>

        <h3>L√≥gica de Programa√ß√£o</h3>
        <button
          onclick="sendPredefined('O que √© uma vari√°vel e como ela funciona?')"
        >
          O que √© uma vari√°vel e como ela funciona?
        </button>
        <button
          onclick="sendPredefined('Explique o que √© um loop e onde √© usado.')"
        >
          Explique o que √© um loop e onde √© usado.
        </button>
        <button onclick="sendPredefined('Qual a diferen√ßa entre if e else?')">
          Qual a diferen√ßa entre if e else?
        </button>

        <h3>Estrutura de C√≥digo</h3>
        <button
          onclick="sendPredefined('Como funciona a estrutura de um programa em Python?')"
        >
          Estrutura de um programa em Python
        </button>
        <button
          onclick="sendPredefined('O que √© uma fun√ß√£o e para que serve?')"
        >
          O que √© uma fun√ß√£o e para que serve?
        </button>
        <button
          onclick="sendPredefined('Por que identa√ß√£o √© importante em Python?')"
        >
          Por que identa√ß√£o √© importante em Python?
        </button>

        <h3>Banco de Dados</h3>
        <button onclick="sendPredefined('O que √© SQL e para que serve?')">
          O que √© SQL e para que serve?
        </button>
        <button
          onclick="sendPredefined('Explique a diferen√ßa entre chave prim√°ria e estrangeira.')"
        >
          Diferen√ßa entre chave prim√°ria e estrangeira
        </button>
        <button
          onclick="sendPredefined('Como funciona o comando SELECT no SQL?')"
        >
          Como funciona o comando SELECT?
        </button>
      </div>

      <!-- Chat -->
      <div class="chat-wrapper">
        <div id="chat-box">
          <div class="bot-msg">
            <strong>Eliana:</strong> Ol√°! Sou sua assistente acad√™mica da INTEC.
            Posso ajudar com d√∫vidas sobre programa√ß√£o, algoritmos ou banco de
            dados.
          </div>
        </div>

        <div class="chat-input-area">
          <input
            type="text"
            id="user-input"
            placeholder="Digite sua pergunta..."
          />
          <button onclick="sendMessage()">Enviar</button>
        </div>
        <p id="status-message"></p>
      </div>
    </div>

    <script>
      function sendMessage() {
        const input = document.getElementById("user-input");
        const message = input.value.trim();
        if (!message) return;
        appendUserMessage(message);
        input.value = "";
        fetchBotResponse(message);
      }

      function sendPredefined(message) {
        appendUserMessage(message);
        fetchBotResponse(message);
      }

      function appendUserMessage(message) {
        const chatBox = document.getElementById("chat-box");
        chatBox.innerHTML += `<div class='user-msg'>${message}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
        document.getElementById("status-message").textContent = "Digitando...";
      }

      function appendBotMessage(response) {
        const chatBox = document.getElementById("chat-box");
        chatBox.innerHTML += `<div class='bot-msg'>${response}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function fetchBotResponse(message) {
        fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message }),
        })
          .then((res) => res.json())
          .then((data) => {
            document.getElementById("status-message").textContent = "";
            appendBotMessage(data.response.replace(/\n/g, "<br>"));
          })
          .catch(() => {
            document.getElementById("status-message").textContent =
              "Erro de conex√£o.";
          });
      }

      function clearChat() {
        const chatBox = document.getElementById("chat-box");
        chatBox.innerHTML = `<div class="bot-msg"><strong>Eliana:</strong> Chat limpo. Podemos come√ßar uma nova conversa!</div>`;
      }

      document
        .getElementById("user-input")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendMessage();
        });
    </script>
  </body>
</html>
